// Include необходимые заголовочные файлы
#include <windows.h>
#include <string>
#include <sstream>
#include <iomanip>
#include <ctime>

// Глобальные переменные
const wchar_t CLASS_NAME[] = L"BIOSLikeWindowClass";

// Функция для рисования текста на окне
void DrawTextCenter(HDC hdc, RECT rect, const std::wstring& text, int fontSize = 24, COLORREF color = RGB(0, 255, 0)) {
    HFONT hFont = CreateFont(
        fontSize, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_OUTLINE_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, VARIABLE_PITCH, L"Consolas");
    HFONT hOldFont = (HFONT)SelectObject(hdc, hFont);

    SetTextColor(hdc, color);
    SetBkMode(hdc, TRANSPARENT);
    DrawTextW(hdc, text.c_str(), -1, &rect, DT_CENTER | DT_SINGLELINE);

    SelectObject(hdc, hOldFont);
    DeleteObject(hFont);
}

// Функция для рисования текста с выравниванием по левому краю
void DrawTextLeft(HDC hdc, int x, int y, const std::wstring& text, int fontSize = 20, COLORREF color = RGB(0, 255, 0)) {
    HFONT hFont = CreateFont(
        fontSize, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_OUTLINE_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, VARIABLE_PITCH, L"Consolas");
    HFONT hOldFont = (HFONT)SelectObject(hdc, hFont);

    SetTextColor(hdc, color);
    SetBkMode(hdc, TRANSPARENT);
    TextOutW(hdc, x, y, text.c_str(), text.length());

    SelectObject(hdc, hOldFont);
    DeleteObject(hFont);
}

// Функция для получения текущей даты и времени в формате строки
std::wstring GetCurrentDateTime() {
    std::wostringstream dateTimeStream;
    auto now = std::time(nullptr);
    std::tm localTime;
    localtime_s(&localTime, &now); // Используем localtime_s для безопасного получения локального времени
    dateTimeStream << std::put_time(&localTime, L"%Y-%m-%d %H:%M:%S");
    return dateTimeStream.str();
}

// Процедура окна
LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {
    switch (uMsg) {
    case WM_DESTROY:
        PostQuitMessage(0);
        return 0;

    case WM_KEYDOWN:
        if (wParam == VK_ESCAPE) {
            DestroyWindow(hwnd);
        }
        return 0;

    case WM_PAINT: {
        PAINTSTRUCT ps;
        HDC hdc = BeginPaint(hwnd, &ps);

        RECT rect;
        GetClientRect(hwnd, &rect);

        // Установка черного фона
        HBRUSH blackBrush = CreateSolidBrush(RGB(0, 0, 0));
        FillRect(hdc, &rect, blackBrush);
        DeleteObject(blackBrush);

        // Заголовок BIOS
        RECT headerRect = rect;
        headerRect.top = 20;
        DrawTextCenter(hdc, headerRect, L"BIOS Setup Utility - Version 1.0.0", 32);

        // Информация о системе
        int startY = 100;
        DrawTextLeft(hdc, 50, startY, L"Processor: Intel(R) Core(TM) i7-10700K CPU @ 3.80GHz");
        DrawTextLeft(hdc, 50, startY + 30, L"Memory: 16 GB DDR4");
        DrawTextLeft(hdc, 50, startY + 60, L"Storage: 512 GB SSD");

        // Текущая дата и время
        DrawTextLeft(hdc, 50, startY + 120, L"Current Date and Time: " + GetCurrentDateTime());

        // Опции BIOS
        int optionsY = startY + 200;
        DrawTextLeft(hdc, 50, optionsY, L"F1 System Information");
        DrawTextLeft(hdc, 50, optionsY + 30, L"F2 Advanced");
        DrawTextLeft(hdc, 50, optionsY + 60, L"F3 Boot");
        DrawTextLeft(hdc, 50, optionsY + 90, L"F4 Security");
        DrawTextLeft(hdc, 50, optionsY + 120, L"F10 Save and Exit");

        // Подсказка для выхода
        RECT footerRect = rect;
        footerRect.bottom -= 50;
        DrawTextCenter(hdc, footerRect, L"Press ESC to exit", 20, RGB(255, 0, 0));

        EndPaint(hwnd, &ps);
    }
                  return 0;
    }
    return DefWindowProc(hwnd, uMsg, wParam, lParam);
}

// Точка входа
int WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE, PWSTR, int nCmdShow) {
    WNDCLASS wc = {};
    wc.lpfnWndProc = WindowProc;
    wc.hInstance = hInstance;
    wc.lpszClassName = CLASS_NAME;
    wc.hCursor = NULL;

    RegisterClass(&wc);

    int screenWidth = GetSystemMetrics(SM_CXSCREEN);
    int screenHeight = GetSystemMetrics(SM_CYSCREEN);

    HWND hwnd = CreateWindowEx(
        0,
        CLASS_NAME,
        L"BIOS-like Screen",
        WS_POPUP,
        0, 0, screenWidth, screenHeight,
        NULL,
        NULL,
        hInstance,
        NULL
    );

    if (hwnd == NULL) {
        return 0;
    }

    ShowWindow(hwnd, SW_SHOW);
    UpdateWindow(hwnd);

    MSG msg = {};
    while (GetMessage(&msg, NULL, 0, 0)) {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    return 0;
}
